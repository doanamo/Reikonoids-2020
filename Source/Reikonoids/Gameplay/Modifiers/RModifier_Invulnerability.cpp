#include "RModifier_Invulnerability.h"
#include "../../Actors/RShip.h"
#include "../../Components/RHealthComponent.h"

URModifier_Invulnerability::URModifier_Invulnerability()
{
    URModifier_Base::Name = NSLOCTEXT("Modifier", "Invulnerability", "Invulnerability");
    URModifier_Base::InitialDuration = 15.0f;
}

URModifier_Invulnerability::~URModifier_Invulnerability() = default;

bool URModifier_Invulnerability::Apply(AActor * ModifiedActor)
{
    if(!Super::Apply(ModifiedActor))
        return false;

    // Check for correct actor class and acquire needed component.
    ModifiedShip = Cast<ARShip>(ModifiedActor);
    if(ModifiedShip == nullptr)
        return false; 

    URHealthComponent* HealthComponent = ModifiedShip->HealthComponent;
    check(HealthComponent);

    // Modify damage scale.
    PreviousDamageScale = HealthComponent->DamageScale;
    HealthComponent->DamageScale *= 0.0f;

    return true;
}

void URModifier_Invulnerability::Revert()
{
    Super::Revert();

    // Acquire needed component.
    check(ModifiedShip != nullptr);
    URHealthComponent* HealthComponent = ModifiedShip->HealthComponent;
    check(HealthComponent);

    // Revert damage scale.
    HealthComponent->DamageScale = PreviousDamageScale;
}
